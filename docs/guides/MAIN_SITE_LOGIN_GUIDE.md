# 主站登录功能使用指南

## ✅ 功能已实现

系统现在支持**双登录模式**：
1. **创作者中心登录** - 用于发布笔记
2. **主站登录** - 用于热门笔记学习

## 🎯 为什么需要两个登录？

| 登录类型 | Cookie域名 | 用途 | 必需性 |
|---------|-----------|------|--------|
| 创作者中心 | creator.xiaohongshu.com | 发布笔记 | ✅ 发布功能必需 |
| 主站 | www.xiaohongshu.com | 搜索/浏览笔记 | ✅ 热门笔记学习必需 |

**重要**：这是两个不同域名的Cookie，需要分别登录！

## 📝 使用步骤

### 1. 访问账号管理页面

```
http://localhost:3000
→ 点击左侧菜单"账号管理"
```

### 2. 查看账号状态

每个账号卡片现在显示**两个登录状态**：

```
✅ 激活
创作者: 已登录    ← 创作者中心状态
主站: 未登录      ← 主站状态
```

### 3. 登录创作者中心（用于发布）

```
点击 "🔐 创作者登录" 按钮
→ 系统打开浏览器窗口
→ 使用小红书APP扫码
→ 登录成功后自动保存Cookie
```

**用途**：发布笔记到小红书

### 4. 登录主站（用于热门笔记学习）

```
点击 "🌐 主站登录" 按钮
→ 系统打开浏览器窗口
→ 使用小红书APP扫码
→ 登录成功后自动保存主站Cookie
```

**用途**：抓取热门笔记，学习写作风格

### 5. 验证登录状态

登录成功后，账号卡片会更新：

```
✅ 激活
创作者: 已登录    ← ✅ 绿色
主站: 已登录      ← ✅ 绿色

创作者登录: 2026-02-05 11:30:00
主站登录: 2026-02-05 11:35:00
```

## 🎨 界面说明

### 账号卡片按钮

| 按钮 | 功能 | 说明 |
|------|------|------|
| 🔐 创作者登录 | 登录创作者中心 | 用于发布笔记 |
| 🌐 主站登录 | 登录主站 | 用于热门笔记学习 |
| ⭐ 设为主账号 | 设置主账号 | 默认使用的账号 |
| ✏️ 编辑 | 编辑账号信息 | 修改名称等 |
| 🔒 停用/🔓 激活 | 切换账号状态 | 启用或禁用账号 |
| 📊 统计 | 查看使用统计 | 发布记录等 |
| 🗑️ 删除 | 删除账号 | 永久删除 |

### 登录状态徽章

| 状态 | 颜色 | 说明 |
|------|------|------|
| 已登录 | 绿色 | Cookie有效 |
| 未登录 | 灰色 | 需要登录 |
| 已过期 | 黄色 | Cookie过期 |
| 错误 | 红色 | 登录异常 |

## 🔄 完整使用流程

### 场景1：只发布笔记（不需要热门笔记学习）

```
1. 创建账号
2. 点击 "🔐 创作者登录"
3. 扫码登录
4. 开始发布笔记 ✅
```

### 场景2：使用热门笔记学习功能

```
1. 创建账号
2. 点击 "🔐 创作者登录" （可选，如果要发布）
3. 点击 "🌐 主站登录" （必需）
4. 扫码登录主站
5. 生成文案时勾选"学习热门笔记风格" ✅
```

### 场景3：完整功能（推荐）

```
1. 创建账号
2. 点击 "🔐 创作者登录"
   → 扫码登录创作者中心
3. 点击 "🌐 主站登录"
   → 扫码登录主站
4. 两个登录状态都显示"已登录" ✅
5. 可以使用所有功能：
   - ✅ 发布笔记
   - ✅ 热门笔记学习
   - ✅ 定时发布
   - ✅ 多账号管理
```

## 📊 功能对比

| 功能 | 需要创作者登录 | 需要主站登录 |
|------|--------------|------------|
| 发布笔记 | ✅ 必需 | ❌ 不需要 |
| 定时发布 | ✅ 必需 | ❌ 不需要 |
| 热门笔记学习 | ❌ 不需要 | ✅ 必需 |
| 文案生成（基础） | ❌ 不需要 | ❌ 不需要 |
| 知识库管理 | ❌ 不需要 | ❌ 不需要 |

## 🔍 故障排查

### 问题1：主站登录后仍提示"无登录信息"

**原因**：Cookie未正确保存或已过期

**解决**：
1. 重新点击"🌐 主站登录"
2. 确保扫码成功
3. 等待"主站登录成功"提示
4. 刷新账号列表确认状态

### 问题2：两个登录都需要吗？

**回答**：取决于您的需求

- **只发布**：只需创作者登录
- **只学习**：只需主站登录
- **完整功能**：两个都需要

### 问题3：Cookie会过期吗？

**回答**：会的

- Cookie有效期通常为7-30天
- 过期后需要重新登录
- 系统会显示"已过期"状态

### 问题4：可以用不同账号吗？

**回答**：可以

- 创作者登录和主站登录可以使用不同的小红书账号
- 但建议使用同一个账号，方便管理

## 🎉 使用示例

### 示例1：生成带热门笔记学习的文案

```
前提：已完成主站登录 ✅

1. 进入"文案生成"页面
2. 选择产品
3. 勾选"学习热门笔记风格"
4. 输入关键词"护肤"
5. 点击"生成文案"

结果：
🔑 使用账户 "我的账号" 的主站Cookie (25个)
🔍 开始抓取关键词"护肤"的热门笔记
✅ 第1页抓取成功，获得20篇笔记
✅ 文案生成成功（融合热门笔记风格）
```

### 示例2：发布笔记

```
前提：已完成创作者登录 ✅

1. 进入"文案管理"页面
2. 找到要发布的文案
3. 点击"发布"按钮
4. 系统自动使用创作者Cookie发布

结果：
✅ 发布成功
```

## 📈 技术实现

### 数据库字段

```sql
xhs_accounts表新增字段：
- main_site_cookies TEXT           -- 主站Cookie
- main_site_login_status TEXT      -- 主站登录状态
- main_site_last_login_at DATETIME -- 主站最后登录时间
```

### API端点

```
GET  /api/accounts/main-site/qrcode  -- 获取主站登录二维码
GET  /api/accounts/main-site/status  -- 检查主站登录状态
```

### Cookie优先级

```javascript
热门笔记抓取Cookie获取顺序：
1. 当前活跃账户的主站Cookie
2. 第一个已登录主站的账户Cookie
3. 环境变量中的Cookie
```

## ✅ 总结

- ✅ 双登录模式已实现
- ✅ 界面已更新（两个登录按钮）
- ✅ 自动Cookie管理
- ✅ 状态实时显示
- ✅ 完全自动化

**现在您可以：**
1. 分别登录创作者中心和主站
2. 系统自动管理两套Cookie
3. 根据功能自动选择正确的Cookie
4. 享受完整的功能体验！

---

**下一步**：访问 http://localhost:3000 → 账号管理 → 点击"🌐 主站登录"按钮开始使用！
