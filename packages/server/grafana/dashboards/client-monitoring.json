{
  "dashboard": {
    "title": "小红书发布系统 - 客户端监控",
    "tags": ["xhs", "clients", "monitoring"],
    "timezone": "browser",
    "schemaVersion": 16,
    "version": 0,
    "refresh": "30s",
    "panels": [
      {
        "id": 1,
        "title": "在线客户端数量",
        "type": "stat",
        "targets": [
          {
            "expr": "xhs_clients_online",
            "legendFormat": "在线客户端"
          }
        ],
        "gridPos": {
          "h": 4,
          "w": 6,
          "x": 0,
          "y": 0
        }
      },
      {
        "id": 2,
        "title": "客户端总数",
        "type": "stat",
        "targets": [
          {
            "expr": "xhs_clients_total{status=\"all\"}",
            "legendFormat": "总客户端"
          }
        ],
        "gridPos": {
          "h": 4,
          "w": 6,
          "x": 6,
          "y": 0
        }
      },
      {
        "id": 3,
        "title": "心跳频率",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(xhs_client_heartbeats_total[5m])",
            "legendFormat": "{{client_id}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 4
        }
      },
      {
        "id": 4,
        "title": "HTTP请求速率",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(xhs_http_requests_total[5m])",
            "legendFormat": "{{method}} {{route}} - {{status_code}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 4
        }
      },
      {
        "id": 5,
        "title": "HTTP请求延迟 (P95)",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(xhs_http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "{{method}} {{route}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 12
        }
      },
      {
        "id": 6,
        "title": "同步操作速率",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(xhs_sync_operations_total[5m])",
            "legendFormat": "{{client_id}} - {{data_type}} - {{operation}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 12
        }
      },
      {
        "id": 7,
        "title": "同步队列大小",
        "type": "graph",
        "targets": [
          {
            "expr": "xhs_sync_queue_size",
            "legendFormat": "{{client_id}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 20
        }
      },
      {
        "id": 8,
        "title": "MQTT连接状态",
        "type": "stat",
        "targets": [
          {
            "expr": "xhs_mqtt_connection_status",
            "legendFormat": "MQTT状态"
          }
        ],
        "gridPos": {
          "h": 4,
          "w": 6,
          "x": 12,
          "y": 20
        }
      },
      {
        "id": 9,
        "title": "MQTT消息速率",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(xhs_mqtt_messages_published_total[5m])",
            "legendFormat": "发布 - {{topic}}"
          },
          {
            "expr": "rate(xhs_mqtt_messages_received_total[5m])",
            "legendFormat": "接收 - {{topic}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 24
        }
      },
      {
        "id": 10,
        "title": "错误率",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(xhs_errors_total[5m])",
            "legendFormat": "{{type}} - {{severity}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 28
        }
      },
      {
        "id": 11,
        "title": "数据库查询延迟",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(xhs_db_query_duration_seconds_bucket[5m]))",
            "legendFormat": "{{operation}}"
          }
        ],
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 28
        }
      }
    ]
  }
}
